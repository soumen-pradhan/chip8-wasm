(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const u of i.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();const G=console.log,d=t=>{throw new Error(t)},X=t=>new Promise(e=>setTimeout(e,t)),ce="/chip8-wasm/assets/chip8_wasm_bg-214a2669.wasm",se=async(t={},e)=>{let n;if(e.startsWith("data:")){const r=e.replace(/^data:.*?base64,/,"");let o;if(typeof Buffer=="function"&&typeof Buffer.from=="function")o=Buffer.from(r,"base64");else if(typeof atob=="function"){const i=atob(r);o=new Uint8Array(i.length);for(let u=0;u<i.length;u++)o[u]=i.charCodeAt(u)}else throw new Error("Cannot decode base64-encoded data URL");n=await WebAssembly.instantiate(o,t)}else{const r=await fetch(e),o=r.headers.get("Content-Type")||"";if("instantiateStreaming"in WebAssembly&&o.startsWith("application/wasm"))n=await WebAssembly.instantiateStreaming(r,t);else{const i=await r.arrayBuffer();n=await WebAssembly.instantiate(i,t)}}return n.instance.exports};let s;function _e(t){s=t}const l=new Array(128).fill(void 0);l.push(void 0,null,!0,!1);function a(t){return l[t]}let y=l.length;function ue(t){t<132||(l[t]=y,y=t)}function J(t){const e=a(t);return ue(t),e}const Ae=typeof TextDecoder>"u"?(0,module.require)("util").TextDecoder:TextDecoder;let $=new Ae("utf-8",{ignoreBOM:!0,fatal:!0});$.decode();let B=null;function ee(){return(B===null||B.byteLength===0)&&(B=new Uint8Array(s.memory.buffer)),B}function O(t,e){return t=t>>>0,$.decode(ee().subarray(t,t+e))}function c(t){y===l.length&&l.push(l.length+1);const e=y;return y=l[e],l[e]=t,e}let te=0;function de(t,e){const n=e(t.length*1,1)>>>0;return ee().set(t,n/1),te=t.length,n}function g(t,e){try{return t.apply(this,e)}catch(n){s.__wbindgen_exn_store(c(n))}}class A{static __wrap(e){e=e>>>0;const n=Object.create(A.prototype);return n.__wbg_ptr=e,n}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();s.__wbg_chip_free(e)}static new(){const e=s.chip_new();return A.__wrap(e)}static vram_width(){return s.chip_vram_width()>>>0}static vram_height(){return s.chip_vram_height()>>>0}vram_ptr(){return s.chip_vram_ptr(this.__wbg_ptr)}load(e){const n=de(e,s.__wbindgen_malloc),r=te;s.chip_load(this.__wbg_ptr,n,r)}next(){return s.chip_next(this.__wbg_ptr)!==0}tick(){const e=s.chip_tick(this.__wbg_ptr);return W.__wrap(e)}set_key(e){s.chip_set_key(this.__wbg_ptr,e)}unset_key(e){s.chip_unset_key(this.__wbg_ptr,e)}}class W{static __wrap(e){e=e>>>0;const n=Object.create(W.prototype);return n.__wbg_ptr=e,n}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();s.__wbg_outputchange_free(e)}get vram(){return s.__wbg_get_outputchange_vram(this.__wbg_ptr)!==0}set vram(e){s.__wbg_set_outputchange_vram(this.__wbg_ptr,e)}get beep(){return s.__wbg_get_outputchange_beep(this.__wbg_ptr)!==0}set beep(e){s.__wbg_set_outputchange_beep(this.__wbg_ptr,e)}}function fe(t){J(t)}function le(t){const e=a(t).crypto;return c(e)}function ge(t){const e=a(t);return typeof e=="object"&&e!==null}function me(t){const e=a(t).process;return c(e)}function pe(t){const e=a(t).versions;return c(e)}function we(t){const e=a(t).node;return c(e)}function be(t){return typeof a(t)=="string"}function he(){return g(function(){const t=module.require;return c(t)},arguments)}function ye(t,e){const n=O(t,e);return c(n)}function ve(t){const e=a(t).msCrypto;return c(e)}function Ee(){return g(function(t,e){a(t).getRandomValues(a(e))},arguments)}function xe(){return g(function(t,e){a(t).randomFillSync(J(e))},arguments)}function Re(t){return typeof a(t)=="function"}function Ue(t,e){const n=new Function(O(t,e));return c(n)}function Se(){return g(function(t,e){const n=a(t).call(a(e));return c(n)},arguments)}function Te(){return g(function(){const t=self.self;return c(t)},arguments)}function Ce(){return g(function(){const t=window.window;return c(t)},arguments)}function Be(){return g(function(){const t=globalThis.globalThis;return c(t)},arguments)}function Le(){return g(function(){const t=global.global;return c(t)},arguments)}function ke(t){return a(t)===void 0}function De(){return g(function(t,e,n){const r=a(t).call(a(e),a(n));return c(r)},arguments)}function Pe(t){const e=a(t).buffer;return c(e)}function Ie(t,e,n){const r=new Uint8Array(a(t),e>>>0,n>>>0);return c(r)}function Fe(t){const e=new Uint8Array(a(t));return c(e)}function Ge(t,e,n){a(t).set(a(e),n>>>0)}function Me(t){const e=new Uint8Array(t>>>0);return c(e)}function Qe(t,e,n){const r=a(t).subarray(e>>>0,n>>>0);return c(r)}function Ne(t){const e=a(t);return c(e)}function Oe(t,e){throw new Error(O(t,e))}function We(){const t=s.memory;return c(t)}URL=globalThis.URL;const _=await se({"./chip8_wasm_bg.js":{__wbindgen_object_drop_ref:fe,__wbg_crypto_c48a774b022d20ac:le,__wbindgen_is_object:ge,__wbg_process_298734cf255a885d:me,__wbg_versions_e2e78e134e3e5d01:pe,__wbg_node_1cd7a5d853dbea79:we,__wbindgen_is_string:be,__wbg_require_8f08ceecec0f4fee:he,__wbindgen_string_new:ye,__wbg_msCrypto_bcb970640f50a1e8:ve,__wbg_getRandomValues_37fa2ca9e4e07fab:Ee,__wbg_randomFillSync_dc1e9a60c158336d:xe,__wbindgen_is_function:Re,__wbg_newnoargs_581967eacc0e2604:Ue,__wbg_call_cb65541d95d71282:Se,__wbg_self_1ff1d729e9aae938:Te,__wbg_window_5f4faef6c12b79ec:Ce,__wbg_globalThis_1d39714405582d3c:Be,__wbg_global_651f05c6a0944d1c:Le,__wbindgen_is_undefined:ke,__wbg_call_01734de55d61e11d:De,__wbg_buffer_085ec1f694018c4f:Pe,__wbg_newwithbyteoffsetandlength_6da8e527659b86aa:Ie,__wbg_new_8125e318e6245eed:Fe,__wbg_set_5cf90238115182c3:Ge,__wbg_newwithlength_e5d69174d6984cd7:Me,__wbg_subarray_13db269f57aa838d:Qe,__wbindgen_object_clone_ref:Ne,__wbindgen_throw:Oe,__wbindgen_memory:We}},ce),re=_.memory,Ve=_.__wbg_chip_free,Ke=_.__wbg_outputchange_free,qe=_.__wbg_get_outputchange_vram,Ze=_.__wbg_set_outputchange_vram,Ye=_.__wbg_get_outputchange_beep,je=_.__wbg_set_outputchange_beep,ze=_.chip_new,He=_.chip_vram_ptr,Xe=_.chip_load,Je=_.chip_next,$e=_.chip_tick,et=_.chip_set_key,tt=_.chip_unset_key,rt=_.chip_vram_width,nt=_.chip_vram_height,ot=_.__wbindgen_malloc,at=_.__wbindgen_exn_store,it=Object.freeze(Object.defineProperty({__proto__:null,__wbg_chip_free:Ve,__wbg_get_outputchange_beep:Ye,__wbg_get_outputchange_vram:qe,__wbg_outputchange_free:Ke,__wbg_set_outputchange_beep:je,__wbg_set_outputchange_vram:Ze,__wbindgen_exn_store:at,__wbindgen_malloc:ot,chip_load:Xe,chip_new:ze,chip_next:Je,chip_set_key:et,chip_tick:$e,chip_unset_key:tt,chip_vram_height:nt,chip_vram_ptr:He,chip_vram_width:rt,memory:re},Symbol.toStringTag,{value:"Module"}));_e(it);const V=new Map([["Chip8 Pic","roms/loktar00/Chip8 Picture.ch8"],["IBM Logo","roms/loktar00/IBM Logo.ch8"],["Brix","roms/loktar00/Brix [Andreas Gustafsson, 1990].ch8"],["Particles","roms/loktar00/Particle Demo [zeroZshadow, 2008].ch8"],["Zero","roms/loktar00/Zero Demo [zeroZshadow, 2007].ch8"],["Keypad","roms/loktar00/Keypad Test [Hap, 2006].ch8"],["Maze","roms/loktar00/Maze [David Winter, 199x].ch8"],["Trip8","roms/loktar00/Trip8 Demo (2008) [Revival Studios].ch8"],["Heart Beat","roms/mattmikolay/heartmonitor/heart_monitor.ch8"],["Morse Code","roms/mattmikolay/morsecode/morse_demo.ch8"],["Random","roms/mattmikolay/randomnumber/random_number_test.ch8"],["WipeOff","roms/aquova/WIPEOFF"],["Test Image","roms/aquova/TEST_IMG"]]),p=new Map([["1",[1,0]],["2",[2,1]],["3",[3,2]],["4",[12,3]],["q",[4,4]],["w",[5,5]],["e",[6,6]],["r",[13,7]],["a",[7,8]],["s",[8,9]],["d",[9,10]],["f",[14,11]],["z",[10,12]],["x",[0,13]],["c",[11,14]],["v",[15,15]]]),ne=new Audio("data:audio/wav;base64,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qJrx4KOQjahZxWbcZgztj2c49nKmkId44S71j0c8eV9yDK6uPRzx5X18eDvjvQ6yKo9ZSS6l//8elePK/Lf//IInrOF/FvDoADYAGBMGb7FtErm5MXMlmPAJQVgWta7Zx2go+8xJ0UiCb8LHHdftWyLJE0QIAIsI+UbXu67dZMjmgDGCGl1H+vpF4NSDckSIkk7Vd+sxEhBQMRU8j/12UIRhzSaUdQ+rQU5kGeFxm+hb1oh6pWWmv3uvmReDl0UnvtapVaIzo1jZbf/pD6ElLqSX+rUmOQNpJFa/r+sa4e/pBlAABoAAAAA3CUgShLdGIxsY7AUABPRrgCABdDuQ5GC7DqPQCgbbJUAoRSUj+NIEig0YfyWUho1VBBBA//uQZB4ABZx5zfMakeAAAAmwAAAAF5F3P0w9GtAAACfAAAAAwLhMDmAYWMgVEG1U0FIGCBgXBXAtfMH10000EEEEEECUBYln03TTTdNBDZopopYvrTTdNa325mImNg3TTPV9q3pmY0xoO6bv3r00y+IDGid/9aaaZTGMuj9mpu9Mpio1dXrr5HERTZSmqU36A3CumzN/9Robv/Xx4v9ijkSRSNLQhAWumap82WRSBUqXStV/YcS+XVLnSS+WLDroqArFkMEsAS+eWmrUzrO0oEmE40RlMZ5+ODIkAyKAGUwZ3mVKmcamcJnMW26MRPgUw6j+LkhyHGVGYjSUUKNpuJUQoOIAyDvEyG8S5yfK6dhZc0Tx1KI/gviKL6qvvFs1+bWtaz58uUNnryq6kt5RzOCkPWlVqVX2a/EEBUdU1KrXLf40GoiiFXK///qpoiDXrOgqDR38JB0bw7SoL+ZB9o1RCkQjQ2CBYZKd/+VJxZRRZlqSkKiws0WFxUyCwsKiMy7hUVFhIaCrNQsKkTIsLivwKKigsj8XYlwt/WKi2N4d//uQRCSAAjURNIHpMZBGYiaQPSYyAAABLAAAAAAAACWAAAAApUF/Mg+0aohSIRobBAsMlO//Kk4soosy1JSFRYWaLC4qZBYWFRGZdwqKiwkNBVmoWFSJkWFxX4FFRQWR+LsS4W/rFRb/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////VEFHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAU291bmRib3kuZGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMjAwNGh0dHA6Ly93d3cuc291bmRib3kuZGUAAAAAAAAAACU="),oe=new Float32Array([-.99,.99,0,0,-.99,-.99,0,1,.99,-.99,1,1,.99,.99,1,0]),ct={attributes:[{shaderLocation:0,offset:0,format:"float32x2"},{shaderLocation:2,offset:4*2,format:"float32x2"}],arrayStride:4*4,stepMode:"vertex"},st=new Float32Array([1,0,0,0,1,0,0,0,1,1,1,0]),_t={attributes:[{shaderLocation:1,offset:0,format:"float32x3"}],arrayStride:4*3,stepMode:"vertex"},M=new Uint16Array([0,1,2,0,2,3]),Q=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,.19,.19,.19,1,.87,.87,.87,1]),ut=`struct VSOut {
    @builtin(position) pos: vec4f,
    // @location(0) color: vec3f,
    @location(0) uv: vec2f,
};

struct UBO {
  mvp: mat4x4<f32>,
  primaryColor: vec4f,
  accentColor: vec4f
};

@group(0) @binding(0)
var<uniform> uniforms: UBO;

@vertex
fn main(
    @location(0) in_pos: vec2f,
    @location(1) in_color: vec3f,
    @location(2) in_uv: vec2f,
) -> VSOut {
    var vs_out: VSOut;

    vs_out.pos = uniforms.mvp * vec4f(in_pos, 0.0, 1.0);
    // vs_out.color = in_color;
    vs_out.uv = in_uv;

    return vs_out;
}
`,At=`@group(1) @binding(1)
var texSampler: sampler;

@group(1) @binding(2)
var tex: texture_2d<f32>;

struct UBO {
  mvp: mat4x4<f32>,
  primaryColor: vec4f,
  accentColor: vec4f
};

@group(0) @binding(0)
var<uniform> uniforms: UBO;

@fragment
fn main(
    // @location(0) frag_color: vec3f,
    @location(0) uv: vec2f
) -> @location(0) vec4f {
    var texColor = textureSample(tex, texSampler, uv) * 255;

    let outputColor = mix(
        uniforms.primaryColor,
        uniforms.accentColor,
        texColor.r
    );

    // return vec4f(texColor * 200, 1.0);
    // return vec4f(texColor.rrg, 1.0);
    return vec4f(outputColor.rgb, 1.0);
}
`;function dt(t,e,n,r){const o=navigator.gpu.getPreferredCanvasFormat(),i=t.getContext("webgpu");i.configure({device:e,format:o,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,alphaMode:"opaque"});const u=e.createTexture({size:[t.width,t.height,1],dimension:"2d",format:"depth24plus-stencil8",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC});function b(C,Z){const h=e.createBuffer({size:C.byteLength+3&-4,usage:Z,mappedAtCreation:!0});return(C instanceof Float32Array?new Float32Array(h.getMappedRange()):new Uint16Array(h.getMappedRange())).set(C),h.unmap(),h}const v=b(oe,GPUBufferUsage.VERTEX),E=b(st,GPUBufferUsage.VERTEX),x=b(M,GPUBufferUsage.INDEX),D=b(Q,GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST),R=e.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{}}]}),P=e.createBindGroup({layout:R,entries:[{binding:0,resource:{buffer:D}}]}),[U,S]=[A.vram_width(),A.vram_height()],I=e.createTexture({size:{width:A.vram_width(),height:A.vram_height(),depthOrArrayLayers:1},format:"r8unorm",usage:GPUTextureUsage.COPY_DST|GPUTextureUsage.TEXTURE_BINDING}),T=e.createSampler({addressModeU:"repeat",addressModeV:"repeat",magFilter:"nearest",minFilter:"nearest"}),K=e.createBindGroupLayout({entries:[{binding:1,visibility:GPUShaderStage.FRAGMENT,sampler:{type:"filtering"}},{binding:2,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float"}}]}),ae=e.createBindGroup({layout:K,entries:[{binding:1,resource:T},{binding:2,resource:I.createView()}]}),ie=e.createRenderPipeline({layout:e.createPipelineLayout({bindGroupLayouts:[R,K]}),vertex:{module:e.createShaderModule({code:ut}),entryPoint:"main",buffers:[ct,_t]},fragment:{module:e.createShaderModule({code:At}),entryPoint:"main",targets:[{format:o}]},primitive:{cullMode:"none",frontFace:"cw",topology:"triangle-list"},depthStencil:{depthWriteEnabled:!0,depthCompare:"less",format:"depth24plus-stencil8"}});async function q(C){for(;n.next();){const Y=n.tick();if(Y.beep&&ne.play(),Y.vram)break;await X(.05)}e.queue.writeTexture({texture:I},r,{offset:0,bytesPerRow:U},{width:U,height:S});const h={view:i.getCurrentTexture().createView(),clearValue:{r:0,g:0,b:0,a:1},loadOp:"clear",storeOp:"store"},F=e.createCommandEncoder(),f=F.beginRenderPass({colorAttachments:[h],depthStencilAttachment:{view:u.createView(),depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store",stencilClearValue:0,stencilLoadOp:"clear",stencilStoreOp:"store"}});f.setPipeline(ie),f.setViewport(0,0,t.width,t.height,0,1),f.setScissorRect(0,0,t.width,t.height),f.setBindGroup(0,P),f.setBindGroup(1,ae),f.setVertexBuffer(0,v),f.setVertexBuffer(1,E),f.setIndexBuffer(x,"uint16"),f.drawIndexed(6),f.end(),e.queue.submit([F.finish()]),requestAnimationFrame(q)}requestAnimationFrame(q)}const ft=`#version 300 es

in vec2 aVertCoord;
in vec2 aTexCoord;
out vec2 vTexCoord;

void main() {
    gl_Position = vec4(aVertCoord, 0, 1);
    vTexCoord = aTexCoord;
}
`,lt=`#version 300 es

precision highp float;

// if you don't use some var, compiler might remove it.
uniform sampler2D uTexture;
uniform vec4 uPrimaryColor;
uniform vec4 uAccentColor;

in vec2 vTexCoord;
out vec4 fragColor;

void main() {
    vec4 sampled = texture(uTexture, vTexCoord) * 255.0;
    fragColor = mix(uPrimaryColor , uAccentColor, sampled.r);
}
`;function j(t,e,n){const r=t.createShader(e);return r?(t.shaderSource(r,n),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS)?r:(console.error(t.getShaderInfoLog(r)),t.deleteShader(r),null)):null}function gt(t,e,n){const r=t.createProgram();return r?(t.attachShader(r,e),t.attachShader(r,n),t.linkProgram(r),t.getProgramParameter(r,t.LINK_STATUS)?r:(console.error(t.getProgramInfoLog(r)),t.deleteProgram(r),null)):null}function mt(t,e,n){const r=t.getContext("webgl2")??d("No webgl context"),o=j(r,r.VERTEX_SHADER,ft)??d("Vertex shader not compiled"),i=j(r,r.FRAGMENT_SHADER,lt)??d("Fragment shader not compiled"),u=gt(r,o,i)??d("No Gl Program"),b=r.createBuffer()??d("No vertexBuffer");r.bindBuffer(r.ARRAY_BUFFER,b),r.bufferData(r.ARRAY_BUFFER,oe,r.STATIC_DRAW);const v=r.createBuffer()??d("No vertexBuffer");r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,v),r.bufferData(r.ELEMENT_ARRAY_BUFFER,M,r.STATIC_DRAW);const E=r.getAttribLocation(u,"aVertCoord");r.enableVertexAttribArray(E);const x=r.getAttribLocation(u,"aTexCoord");r.enableVertexAttribArray(x),r.bindBuffer(r.ARRAY_BUFFER,b),r.vertexAttribPointer(E,2,r.FLOAT,!1,4*4,0*4),r.vertexAttribPointer(x,2,r.FLOAT,!1,4*4,2*4);const D=r.createTexture()??d("No texture");r.bindTexture(r.TEXTURE_2D,D),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.useProgram(u);const R=r.getUniformLocation(u,"uTexture")??d("No uniform called 'uTexture'");r.uniform1i(R,0);const P=r.getUniformLocation(u,"uPrimaryColor")??d("No uniform called 'uPrimaryColor'"),U=r.getUniformLocation(u,"uAccentColor")??d("No uniform called 'uAccentColor'");r.uniform4fv(P,Q,4*4,4),r.uniform4fv(U,Q,5*4,4),r.viewport(0,0,t.width,t.height);async function S(I){for(;e.next();){const T=e.tick();if(T.beep&&ne.play(),T.vram)break;await X(.05)}r.clearColor(0,0,0,.2),r.clear(r.COLOR_BUFFER_BIT),r.texImage2D(r.TEXTURE_2D,0,r.R8,A.vram_width(),A.vram_height(),0,r.RED,r.UNSIGNED_BYTE,n),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,v),r.drawElements(r.TRIANGLES,M.length,r.UNSIGNED_SHORT,0),requestAnimationFrame(S)}requestAnimationFrame(S)}const m=document.querySelector("#chip-display");{const e=window.devicePixelRatio??1;m.width=m.clientWidth*e,m.height=m.clientWidth/2*e,G(`Canvas: ${m.width} x ${m.height}`)}const pt=await fetch(V.get("Chip8 Pic")),wt=await pt.arrayBuffer(),bt=new Uint8Array(wt),w=A.new();w.load(bt);const[ht,yt]=[A.vram_width(),A.vram_height()],z=new Uint8Array(re.buffer,w.vram_ptr(),ht*yt),H=document.querySelector("#key-og"),L=document.querySelectorAll("#key-og .key"),k=document.querySelectorAll("#key-map .key");function vt(t){document.addEventListener("keydown",e=>{if(e.preventDefault(),p.has(e.key)){const[n,r]=p.get(e.key);t.set_key(n),L[r].classList.add("invert"),k[r].classList.add("invert")}}),document.addEventListener("keyup",e=>{if(e.preventDefault(),p.has(e.key)){const[n,r]=p.get(e.key);t.unset_key(n),L[r].classList.remove("invert"),k[r].classList.remove("invert")}})}function Et(){H.addEventListener("pointerdown",t=>{t.preventDefault();const e=t.target.dataset.key;if(e&&p.has(e)){const[n,r]=p.get(e);w.set_key(n),L[r].classList.add("invert"),k[r].classList.add("invert")}}),H.addEventListener("pointerup",t=>{t.preventDefault();const e=t.target.dataset.key;if(e&&p.has(e)){const[n,r]=p.get(e);w.unset_key(n),L[r].classList.remove("invert"),k[r].classList.remove("invert")}})}vt(w);Et();const N=document.querySelector("#roms");N.addEventListener("change",async t=>{const e=V.get(N.value),n=await(await fetch(e)).arrayBuffer(),r=new Uint8Array(n);w.load(r)});for(let[t,e]of V){const n=document.createElement("option");n.value=t,n.textContent=t,N.appendChild(n)}async function xt(){try{const t=await(await navigator.gpu?.requestAdapter())?.requestDevice()??null;t?(G("Rendering using WebGPU"),dt(m,t,w,z)):window.WebGL2RenderingContext?(G("Falling back to WebGL"),mt(m,w,z)):d("No Renderer available")}catch(t){console.error(`${t}`);const e=document.querySelector("#app"),n=document.createElement("div");n.classList.add("error"),n.textContent=`${t}`,e.appendChild(n)}}xt();
